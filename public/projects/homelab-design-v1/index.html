<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  
    
  <title>Laptop Homelab in 5 Commands | ivy (likethevine)</title><meta name="description" content="Back when I developed on my Macbook! The BackgroundI have been in tech for over 10 years (look at little me up there), and I have seen firsthand that a proper workflow is essential for any decent project. So, when I bought a 3D printer a few months ago, it was embarrassing to see my lack of workflow. Dealing with the dozens of STL files was a hassle by itself, but then, it came: Raspberry Pi SD card corruption.">
  <meta name="keywords" content="blog,developer,personal">

  

  

  

  <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://ivylikethevine.com/"/>

<meta name="twitter:title" content="Laptop Homelab in 5 Commands"/>
<meta name="twitter:description" content="Back when I developed on my Macbook! The BackgroundI have been in tech for over 10 years (look at little me up there), and I have seen firsthand that a proper workflow is essential for any decent project. So, when I bought a 3D printer a few months ago, it was embarrassing to see my lack of workflow. Dealing with the dozens of STL files was a hassle by itself, but then, it came: Raspberry Pi SD card corruption."/>

  <meta property="og:title" content="Laptop Homelab in 5 Commands" />
<meta property="og:description" content="Back when I developed on my Macbook! The BackgroundI have been in tech for over 10 years (look at little me up there), and I have seen firsthand that a proper workflow is essential for any decent project. So, when I bought a 3D printer a few months ago, it was embarrassing to see my lack of workflow. Dealing with the dozens of STL files was a hassle by itself, but then, it came: Raspberry Pi SD card corruption." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ivylikethevine.com/projects/homelab-design-v1/" /><meta property="og:image" content="https://ivylikethevine.com/"/><meta property="article:section" content="projects" />
<meta property="article:published_time" content="2023-10-12T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-10-24T09:36:41-07:00" />

  <link rel="stylesheet" href="/css/bootstrap.min.css"  crossorigin="anonymous">
  
  <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/all.min.css" rel="stylesheet" type="text/css">

  <link rel="stylesheet" href="/sass/main.css">

  <link rel="stylesheet" href="/zoomjs/zoom.min.css">

  <script src=/js/lazysizes.min.js></script>

  
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="shortcut icon" href="/favicon.png" type="image/x-icon">
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/logo.svg" sizes="any" type="image/svg+xml" />


</head>



<body ontouchstart="">
  <nav class="navbar navbar-default navbar-custom navbar-fixed-top invert">
  <div class="container-fluid">
    
    <div class="navbar-header page-scroll">
      <button type="button" class="navbar-toggle">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://ivylikethevine.com/">ivy (likethevine)</a>
    </div>
    
    <div id="huxblog_navbar">
      <div class="navbar-collapse">
        <ul class="nav navbar-nav navbar-right">
          
          <li><a href="/" title="projects">projects</a></li>
          
          <li><a href="/resume/" title="resume">resume</a></li>
          

          <li class="search-icon">
            <a href="javascript:void(0)">
              <i class="fa fa-search"></i>
            </a>
          </li>
        </ul>
      </div>
    </div>
    
  </div>
  
</nav>
<script>
  
  
  
  var $body = document.body;
  var $toggle = document.querySelector(".navbar-toggle");
  var $navbar = document.querySelector("#huxblog_navbar");
  var $collapse = document.querySelector(".navbar-collapse");

  var __HuxNav__ = {
    close: function () {
      $navbar.className = " ";
      
      setTimeout(function () {
        
        if ($navbar.className.indexOf("in") < 0) {
          $collapse.style.height = "0px";
        }
      }, 400);
    },
    open: function () {
      $collapse.style.height = "auto";
      $navbar.className += " in";
    },
  };

  
  $toggle.addEventListener("click", function (e) {
    if ($navbar.className.indexOf("in") > 0) {
      __HuxNav__.close();
    } else {
      __HuxNav__.open();
    }
  });

  

  document.addEventListener("click", function (e) {
    if (e.target == $toggle) return;
    if (e.target.className == "icon-bar") return;
    __HuxNav__.close();
  });
</script>
  
<div class="search-page">
  <div class="search-icon-close-container">
    <span class="search-icon-close">
      <i class="fa fa-chevron-down"></i>
    </span>
  </div>
  <div class="search-main container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <form></form>
        <input type="text" id="search-input" placeholder="$ grep...">
        </form>
        <div id="search-results" class="mini-post-list"></div>
      </div>
    </div>
  </div>
</div>

  
  


<style type="text/css">
  header.intro-header {
    position: relative;
    background-image: url('');
  }
</style>

<header class="intro-header style-text">

  <div class="header-mask"></div>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-heading">
          <div class="tags">
            
            <a class="tag" href="/tags/linux/" title="linux">linux</a>
            
            <a class="tag" href="/tags/3d-printing/" title="3d-printing">3d-printing</a>
            
            <a class="tag" href="/tags/dns/" title="DNS">DNS</a>
            
            <a class="tag" href="/tags/networking/" title="networking">networking</a>
            
            <a class="tag" href="/tags/docker/" title="docker">docker</a>
            
            <a class="tag" href="/tags/homelab/" title="homelab">homelab</a>
            
            <a class="tag" href="/tags/nas/" title="nas">nas</a>
            
          </div>
          <h1>Laptop Homelab in 5 Commands</h1>
          <h2 class="subheading">A quick &amp; simple NAS/server from my old laptop.</h2>
          <span class="meta">
            Posted by  Ivy Duggan 
            on Thu, Oct 12, 2023
          </span>
          <br/>
          <span class="meta">
            Last edited on Tue, Oct 24, 2023
          </span>
        </div>
      </div>
    </div>
  </div>
</header>


  


<article>
  <div class="container">
    <div class="row">

      
      <div class="
              col-lg-8 col-lg-offset-2
              col-md-10 col-md-offset-1
              post-container">
        <a href='https://www.reviewjournal.com/business/no-lazy-kid-12-year-old-app-developer-off-to-fast-start'>
<p><figure>
  <a class="paragraph-image">
    <img data-src="images/macbook-panera.webp" data-action="zoom" alt="image"  title="Back when I developed on my Macbook! " class="lazyload">
  </a>
  
  <figcaption class="image-caption">Back when I developed on my Macbook! </figcaption>
  
</figure></p>
</a>
<h1 id="the-background">The Background<a class="anchorjs-link" href="#the-background"></a></h1><p>I have been in tech for over 10 years (look at little me up there), and I have seen firsthand that a proper workflow is essential for any decent project. So, when I bought a 3D printer a few months ago, it was embarrassing to see <strong>my</strong> lack of workflow. Dealing with the dozens of STL files was a hassle by itself, but then, it came: <em>Raspberry Pi SD card corruption.</em> And it came again&hellip; and again&hellip; and again&hellip;</p>
<p>With least an hour of configuration per corruption, I finally bit the bullet and started setting up my own server. <strong>tl;dr? here&rsquo;s the <a href="https://gist.github.com/ivylikethevine/adba9472047741476e5a19b8741e906a" target="_blank">full setup script</a></strong></p>
<h3 id="why-a-home-server">Why a Home Server?<a class="anchorjs-link" href="#why-a-home-server"></a></h3><p>I have avoided making my own server for the past few years because I did not have a need for one. At Amazon Music, we had access to the internal architecture &amp; work flows, and during my contracting work, our applications were usually relatively straightforward GIT/CI/CD Node/similar applications.<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> But now, I have graduated college and have the time &amp; skill to setup my own, so lets do it &mdash; on the cheap.</p>
<h3 id="enter-the-laptop-server">Enter&hellip; the Laptop Server<a class="anchorjs-link" href="#enter-the-laptop-server"></a></h3><p>No, a laptop is not the ideal server. They lack multiple ethernet connections, extra storage, and were not designed for this use-case. However, for personal-use deployment, they come with many benefits:</p>
<ol>
<li>Power Efficiency
<ul>
<li>Laptops in general are built for battery life, and thus are designed to draw less power than a desktop/server often would.</li>
<li>Less power use = less waste heat. This is critical to me since the server must be in my bedroom to have access to ethernet.</li>
</ul>
</li>
<li>It&rsquo;s a Laptop
<ul>
<li>Small, easy to place wherever. (Mine sits under my TV)</li>
<li>Instead of a UPS, the laptop battery itself provides a healthy backup when power is cut-out (or more likely, when there are power fluctuations).</li>
<li>Built in keyboard/monitor for debugging <strong>when</strong> something breaks.<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup></li>
</ul>
</li>
<li>I already have one. While I would love a full custom rack setup, <strong>the best server is the server you have <em>right now</em></strong>.</li>
</ol>
<h3 id="the-hardware---nessie-the-2012-macbook-pro">The Hardware - Nessie, the 2012 Macbook Pro<a class="anchorjs-link" href="#the-hardware---nessie-the-2012-macbook-pro"></a></h3><p>For my setup, my server hardware is my old 2012 Macbook Pro 13&quot;:</p>
<ul>
<li><a href="https://www.intel.com/content/www/us/en/products/sku/53450/intel-core-i52430m-processor-3m-cache-up-to-3-00-ghz/specifications.html" target="_blank">Intel Core i5-2430M</a>: 2 cores + hyperthreading, 2.4-3.0Ghz</li>
<li>2 x 2GB DDR3 1333MT/s RAM</li>
<li>1x Gigabit Ethernet</li>
<li>1x Thunderbolt 2 Port</li>
<li>2TB Crucial SATA SSD - Upgraded from original 128GB SSD.</li>
</ul>
<p>The specs are not incredible, and I was uncertain if this would be a performant system (spoiler: it works fine!). I upgraded the SSD with one I had laying around, since 128GB was not sufficient. Production servers should <strong>always have redundant storage and networking</strong>, but beggers can&rsquo;t be choosers! It is possible to adapt the Thunderbolt 2 port to Gigabit ethernet, but dual networking is a rabbithole to follow another day.</p>
<h3 id="the-software---keep-it-simple">The Software - Keep it Simple<a class="anchorjs-link" href="#the-software---keep-it-simple"></a></h3><ul>
<li>OS: <a href="https://ubuntu.com/download/server" target="_blank">Ubuntu 22.04LTS</a></li>
<li>Host Management: <a href="https://cockpit-project.org/" target="_blank">Cockpit</a></li>
<li>Container Management: <a href="https://docs.portainer.io/start/install-ce" target="_blank">Portainer-CE</a></li>
<li>Virtualization: <a href="https://www.docker.com/" target="_blank">Docker</a></li>
<li>NAS Mount Protocol: <a href="https://en.wikipedia.org/wiki/Network_File_System" target="_blank">NFS</a></li>
</ul>
<p>There will be a future post going more in-depth about the specific tech selection! Many popular alternatives were tested or considered, but I arrived at this setup because each of these technologies are well known, well developed, and have tons of community support &amp; documentation.</p>
<h1 id="initial-installation">Initial Installation<a class="anchorjs-link" href="#initial-installation"></a></h1><p>My servers all run Ubuntu 22.04LTS.<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup> Installation of Ubuntu is relatively easy, and the only install configuration required is &ldquo;Install OpenSSH Server&rdquo;. Aside of that, the default settings work fine. <a href="https://ubuntu.com/tutorials/install-ubuntu-server#1-overview" target="_blank">Installation Instructions</a>.</p>
<p>Note: this guide assumes that the laptop is plugged into ethernet during the Ubuntu installation process.</p>
<p>After installing and rebooting, we need to <code>ssh</code> into the laptop to configure it. At this point, our system has a Dynamically Assigned IP address (such as 192.168.1.10), which we need to know in order to connect. If you have access to your router login, simply find the IP address assigned to the <code>hostname</code> of the server, in my case <code>nessie</code>. If you don&rsquo;t have access to that, then login to the server on the laptop (w/ the username &amp; password from installation), and run the following command: <code>hostname -I | awk '{print $1}'</code>. The result is the current IP of the host. The next commands can be run on the device itself, but I find it easier to connect to the host &amp; then copy paste from my normal laptop (versus trying to manipulate text from a command line). So let&rsquo;s configure us a server!</p>
<h2 id="the-five-commandments">The Five Command(ments)<a class="anchorjs-link" href="#the-five-commandments"></a></h2><h3 id="i-thou-art-a-server">I. Thou art a Server<a class="anchorjs-link" href="#i-thou-art-a-server"></a></h3><p>Although we&rsquo;re installing a server OS, there are a few things we want to configure to allow our laptop to &ldquo;act like a server.&rdquo; This command does 2 things:</p>
<ol>
<li>Prevent system from sleeping when the lid is closed.</li>
<li>Turn off the screen after 60 seconds (but not fully disable &ndash; to allow on-device debugging).</li>
</ol>
<p><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">$&#39;HandleLidSwitch=ignore\nHandleLidSwitchDocked=ignore&#39;</span> | sudo tee -a /etc/systemd/logind.conf <span style="color:#ff79c6">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>  sudo <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;GRUB_CMDLINE_LINUX_DEFAULT=\&#34;consoleblank=60\&#34;&#34;</span> | sudo tee -a /etc/default/grub <span style="color:#ff79c6">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>  sudo update-grub</span></span></code></pre></div>
** The <code>&amp;&amp;</code> chaining syntax means that the next command will not execute until/if the previous command executes successfully.</p>
<h3 id="ii-thou-shalt-have-basics">II. Thou Shalt Have Basics<a class="anchorjs-link" href="#ii-thou-shalt-have-basics"></a></h3><p>Ubuntu 22.04LTS comes with many useful packages, but there are a few that I always end up using, so I&rsquo;ve put them here. Of note:</p>
<ol>
<li>The <code>$nrconf</code> line prevents a pop-up window listing services that should be restarted. This halts our config, so I have altered the configuration to list and not pop-up and halt.</li>
<li><code>avahi-daemon</code> and <code>avahi-utils</code> are critical for our link-local addressing.</li>
<li><code>nfs-common</code> is the package we will use to access the files on the NAS as if it were an external drive plugged.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;\$nrconf{restart} = &#39;l&#39;&#34;</span> | sudo tee -a /etc/needrestart/needrestart.conf <span style="color:#ff79c6">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>  sudo apt update -y <span style="color:#ff79c6">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>  sudo apt upgrade -y <span style="color:#ff79c6">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>  sudo apt install -fy zip git htop software-properties-common apt-transport-https wget xclip net-tools curl python3 python3-pip nodejs npm ca-certificates gnupg avahi-daemon avahi-utils nfs-common <span style="color:#ff79c6">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>  sudo apt autoremove -y</span></span></code></pre></div>
<h3 id="iii-thou-shall-have-containers">III. Thou Shall have Containers<a class="anchorjs-link" href="#iii-thou-shall-have-containers"></a></h3><p>In the Homelab/Selfhosted/NAS space, containerized applications are common (and awesome!). Docker lets our server run containers, meaning we can run software on our host server without having to configure the host for every single application. Each container is separate and (more or less) sandboxed.<sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup> In the case of deploying templates, containers are essentially &ldquo;applications&rdquo; that run on our server.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo install -m <span style="color:#bd93f9">0755</span> -d /etc/apt/keyrings <span style="color:#ff79c6">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>  curl -fsSL &lt;https://download.docker.com/linux/ubuntu/gpg&gt; | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg <span style="color:#ff79c6">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>  sudo chmod a+r /etc/apt/keyrings/docker.gpg <span style="color:#ff79c6">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"></span>    <span style="color:#f1fa8c">&#34;deb [arch=&#34;</span><span style="color:#ff79c6">$(</span>dpkg --print-architecture<span style="color:#ff79c6">)</span><span style="color:#f1fa8c">&#34; signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">  &#34;</span><span style="color:#ff79c6">$(</span>. /etc/os-release <span style="color:#ff79c6">&amp;&amp;</span> <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;</span><span style="color:#8be9fd;font-style:italic">$VERSION_CODENAME</span><span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">)</span><span style="color:#f1fa8c">&#34; stable&#34;</span> |
</span></span><span style="display:flex;"><span>  sudo tee /etc/apt/sources.list.d/docker.list &gt;/dev/null <span style="color:#ff79c6">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>  sudo apt update -y <span style="color:#ff79c6">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>  sudo apt install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin <span style="color:#ff79c6">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>  sudo usermod -aG docker <span style="color:#8be9fd;font-style:italic">$USER</span> <span style="color:#ff79c6">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>  newgrp docker <span style="color:#ff79c6">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>  sudo systemctl <span style="color:#8be9fd;font-style:italic">enable</span> docker</span></span></code></pre></div>
<h3 id="iv-thou-shalt-be-web-monitored">IV. Thou Shalt be Web Monitored<a class="anchorjs-link" href="#iv-thou-shalt-be-web-monitored"></a></h3><p>For this server, two different monitoring solutions are needed.</p>
<ol>
<li><code>cockpit</code> - managing the host device &amp; NAS file sharing
<ul>
<li>we also install <code>cockpit-file-sharing</code> from 45Drives, which allows easy NAS setup from the cockpit webUI</li>
</ul>
</li>
<li><code>portainer</code> - a containerized application that allows the monitoring &amp; deployment of other containerized applications</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo mkdir /portainer_data <span style="color:#ff79c6">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>  docker volume create portainer_data <span style="color:#ff79c6">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>  docker run -d -p 8000:8000 -p 9443:9443 --name portainer --restart<span style="color:#ff79c6">=</span>always -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/portainer_data portainer/portainer-ce:latest <span style="color:#ff79c6">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>  sudo apt install -y cockpit cockpit-pcp <span style="color:#ff79c6">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>  curl -LO &lt;https://github.com/45Drives/cockpit-file-sharing/releases/download/v3.2.9/cockpit-file-sharing_3.2.9-2focal_all.deb&gt; <span style="color:#ff79c6">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>  sudo apt install -y ./cockpit-file-sharing_3.2.9-2focal_all.deb <span style="color:#ff79c6">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>  rm ./cockpit-file-sharing_3.2.9-2focal_all.deb</span></span></code></pre></div>
<h3 id="v-thou-shalt-not-break-dns">V. Thou Shalt Not Break DNS<a class="anchorjs-link" href="#v-thou-shalt-not-break-dns"></a></h3><p>After hours of blood, sweat, and tears, I&rsquo;ve arrived at a networking configuration that satisfies the following:</p>
<ol>
<li>Work with <code>cockpit</code>. (Requires use of <code>NetworkManager</code> for proper updates &amp; network monitoring in the Web UI, not <code>networkd</code>)</li>
<li>Don&rsquo;t break DNS. (Can&rsquo;t run my own DNS server/sinkhole)</li>
<li>Use a named address &amp; a dynamic IP. (<code>&lt;hostname&gt;.local</code> with DHCP)</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;network:
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">  version: 2
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">  renderer: NetworkManager
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">  ethernets:
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    </span><span style="color:#ff79c6">$(</span>ip -o -4 route show to default | awk <span style="color:#f1fa8c">&#39;{print $5}&#39;</span><span style="color:#ff79c6">)</span><span style="color:#f1fa8c">:
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">      dhcp4: true
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">      link-local: [ ipv4 ]&#34;</span> | sudo tee /etc/netplan/00-installer-config.yaml <span style="color:#ff79c6">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>  sudo netplan apply</span></span></code></pre></div>
<p>Essentially what I am doing here is overwriting the default wired <code>netplan</code> with my own configuration. The renderer is set to <code>NetworkManager</code> to work with <code>cockpit</code>&rsquo;s UI. The line <code>$(ip -o -4 route show to default | awk '{print $5}'):</code> is a nifty way to grab the current active ethernet connection and configure it (versus unconfigured or virtual interfaces). On my macbook, it evalutes to <code>ens9</code>, the name of the built-in ethernet interface. We enable <code>dhcp4</code>, since my home network only uses <code>ipv4</code>, not <code>ipv6</code>, and my router uses DHCP instead of static IPs (as do most home networks).<sup id="fnref:5"><a href="#fn:5" class="footnote-ref" role="doc-noteref">5</a></sup> <sup id="fnref:6"><a href="#fn:6" class="footnote-ref" role="doc-noteref">6</a></sup> <sup id="fnref:7"><a href="#fn:7" class="footnote-ref" role="doc-noteref">7</a></sup></p>
<p>The <code>link-local: [ ipv4 ]</code> line is also crucial, as it works with <code>avahi-daemon</code>/<code>avahi-utils</code> to tell other devices on our network that <code>nessie.local</code> can be used, not a dynamically changing IP address. Alternate solutions involve editing files on every host (which is a hassle), or creating a custom DNS server (which is also a hassle and I could break the wifi for my roommate, which would be very bad!)</p>
<p>After the new <code>netplan</code> configuration is applied, our <code>ssh</code> session break or disconnect, so close the terminal and wait a few minutes. Then, reboot the machine (from command line: <code>sudo reboot</code>). When it finishes booting (which may take a few minutes, internet interfaces can take a while to start), you should be able to access it via <code>https://&lt;hostname&gt;.local:9090</code> for cockpit <code>https://&lt;hostname&gt;.local:9443</code> for portainer. At this point, all management can be done via cockpit&rsquo;s terminal or portainer&rsquo;s UI!</p>
<h3 id="congratulations-">Congratulations 🎉<a class="anchorjs-link" href="#congratulations-"></a></h3><p>Now just configure the software we&rsquo;ve installed &amp; enjoy:</p>
<ul>
<li>
<p><a href="https://docs.portainer.io/start/install-ce/server/setup" target="_blank">Initial Portainer Setup</a></p>
</li>
<li>
<p>Optional: Change portainer templates to 3rd party repo to allow more 1-click application deployments, such as <a href="https://github.com/lissy93/portainer-templates" target="_blank">https://github.com/lissy93/portainer-templates</a></p>
</li>
<li>
<p><a href="https://github.com/45Drives/cockpit-file-sharing#samba-management-tab" target="_blank">Configure SAMBA on the server for Windows Clients</a></p>
</li>
<li>
<p><a href="https://github.com/45Drives/cockpit-file-sharing#nfs-management-tab" target="_blank">Configure NFS on the server for linux clients</a></p>
</li>
<li>
<p>Optional: Mount folder at boot on Linux client with the following command (requires <code>sudo apt install -y nfs-common</code> first):
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#39;&lt;hostname&gt;.local:/&lt;nfs_folder&gt;    /&lt;local_mount&gt;   nfs rw,auto,nofail,noatime,nolock,intr,tcp,actimeo=1800 0 0&#39;</span> | sudo tee -a /etc/fstab <span style="color:#ff79c6">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>  sudo mount -a</span></span></code></pre></div></p>
<ul>
<li><code>&lt;hostname&gt;</code> - ex: nessie</li>
<li><code>&lt;nfs_folder&gt;</code> - the name of the nfs folder created above</li>
<li><code>&lt;local_mount&gt;</code> - the folder on the client device to alias to the server
<ul>
<li>often the <code>/media/&lt;folder&gt;</code> or <code>/mnt/&lt;folder&gt;</code>. ex: <code>/mnt/nessie</code></li>
<li>folder must be created before the <code>fstab</code> file modification<sup id="fnref:8"><a href="#fn:8" class="footnote-ref" role="doc-noteref">8</a></sup>, ex: <code>sudo mkdir /mnt/nessie</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>Next up, we&rsquo;ll configure offsite backups via a containerized application since our server has ZERO redundancy!</strong></p>
<h5 id="footnotes">Footnotes<a class="anchorjs-link" href="#footnotes"></a></h5><div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>I also had an experience with a developer above me that &ldquo;pushed changes to his local server, but forgot to push the changes to us&rdquo; around every week or so.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>I <strong>often</strong> broke my ability to communicate with the server during network configuration and had to run commands on the laptop itself to fix it.&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p>LTS designation means that this version of the OS will receive support for 5 years. I prefer to run an LTS version of an OS, since I&rsquo;d rather have stability versus new features (and doubly so on a server).&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4">
<p>Containerization is more complex than this, and the security implications of containers is its own discussion, but for most users, the simple understanding works.&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:5">
<p><code>ipv4</code> addresses follow a period deliminated format, such as <code>192.168.1.1</code> (typically the router&rsquo;s IP address), but <code>ipv6</code> uses colon deliminated addresses, such as <code>fd12:3456:789a:1::1</code>. <code>ipv6</code> is useful in larger deployments, but unnecessary for most home use.&#160;<a href="#fnref:5" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:6">
<p>In a DHCP network, typically the router assigns IP addresses to all devices, but these addresses (192.168.1.XX) can change when a device is disconnected/restarted. Static IPs do not change, but usually require more configuration.&#160;<a href="#fnref:6" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:7">
<p><a href="https://netplan.readthedocs.io/en/stable/netplan-yaml/" target="_blank">Netplan Documentation</a>&#160;<a href="#fnref:7" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:8">
<p><code>fstab</code> is a file that essentially lists all drives and how to connect to them on boot.&#160;<a href="#fnref:8" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>


        <hr style="visibility: hidden;" />
        <ul class="pager">
          
          <li class="previous">
            <a href="/resume/" data-toggle="tooltip" data-placement="top" title="Resumé">
              Previous<br>
              <span>Resumé</span>
            </a>
          </li>
          
          
          <li class="next">
            <a href="/projects/site/" data-toggle="tooltip" data-placement="top" title="Dev Ops are not Optional.">
              Next<br>
              <span>Dev Ops are not Optional.</span>
            </a>
          </li>
          
        </ul>
        <hr style="visibility: hidden;" />

        
        



<div class="giscus" id="comments"></div>
<script src="https://giscus.app/client.js" 
  data-repo="ivylikethevine/ivylikethevine" 
  data-repo-id="R_kgDOKTpUbw"
  data-category="General"
  data-category-id="DIC_kwDOKTpUb84CZ09b"
  data-mapping="pathname"
  data-strict="0" 
  data-reactions-enabled="1" 
  data-emit-metadata="0" 
  data-input-position="top"
  data-theme="light"
  data-lang="en"
  crossorigin="anonymous"
  async>
  </script>




      </div>

      
      
      
      
      <div class="
              col-lg-8 col-lg-offset-2
              col-md-10 col-md-offset-1
              sidebar-container">

        
        
        <section>
  
  
  <hr class="hidden-sm hidden-xs">
  
  <h5>FEATURED TAGS</h5>
  <div class="tags">
    
    <a href="/tags/3d-printing/">3d-printing</a>
    
    <a href="/tags/backups/">backups</a>
    
    <a href="/tags/ci/cd/">CI/CD</a>
    
    <a href="/tags/cloudflare/">Cloudflare</a>
    
    <a href="/tags/cognitive-science/">cognitive science</a>
    
    <a href="/tags/data-redundancy/">data redundancy</a>
    
    <a href="/tags/dev-ops/">dev ops</a>
    
    <a href="/tags/devops/">devops</a>
    
    <a href="/tags/dns/">DNS</a>
    
    <a href="/tags/docker/">docker</a>
    
    <a href="/tags/full-stack/">full stack</a>
    
    <a href="/tags/github/">github</a>
    
    <a href="/tags/homelab/">homelab</a>
    
    <a href="/tags/hugo/">hugo</a>
    
    <a href="/tags/linux/">linux</a>
    
    <a href="/tags/nas/">nas</a>
    
    <a href="/tags/networking/">networking</a>
    
    <a href="/tags/storage/">storage</a>
    
    <a href="/tags/typescript/">typescript</a>
    
    <a href="/tags/usb/">usb</a>
    
  </div>
</section>

        
        

      </div>
    </div>
  </div>
</article>



  
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        
        <ul class="list-inline text-center">

<li>
  <a href="https://github.com/ivylikethevine" target="_blank">
    <span class="fa-stack fa-lg">
      <i class="fa fa-circle fa-stack-2x"></i>
      <i class="fab fa-github fa-stack-1x fa-inverse"></i>
    </span>
  </a>
</li>

<li>
  <a href="https://linkedin.com/in/ivylikethevine" target="_blank">
    <span class="fa-stack fa-lg">
      <i class="fa fa-circle fa-stack-2x"></i>
      <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
    </span>
  </a>
</li>

<li>
  <a href="https://medium.com/@ivylikethevine" target="_blank">
    <span class="fa-stack fa-lg">
      <i class="fa fa-circle fa-stack-2x"></i>
      <i class="fab fa-medium fa-stack-1x fa-inverse"></i>
    </span>
  </a>
</li></ul>

        <p class="copyright text-muted">
          Copyright &copy; ivy (likethevine) 2023  
          <br>
          Powered by <a href="https://gohugo.io">Hugo</a>
        </p>
      </div>
    </div>
  </div>
</footer>

<script src=/js/jquery.min.js></script>
<script src=/js/bootstrap.min.js crossorigin="anonymous"></script>



<script src="/js/hux-blog.min.c4ea77041cd3edbfc8b2622cd887a9a5d8760a4162d14489e36d2a3fa4c90172.js"></script>


<script src=/js/simple-jekyll-search.min.js></script>


<script src="/js/search.min.53bce5da475b4d362500e5ce5dddfa22e20e1b9018777411d2020b4b839c9310.js"></script>













<script src="/zoomjs/zoom.min.js"></script>

</body>

</html>